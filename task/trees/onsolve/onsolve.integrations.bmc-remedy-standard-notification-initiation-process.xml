<tree schema_version="1.0">
<sourceName>OnSolve</sourceName>
<sourceGroup>Integrations</sourceGroup>
<type>Tree</type>
<status>Active</status>
<taskTree builder_version="" schema_version="1.0" version="">
        <name>BMC Remedy Standard Notification Initiation Process</name>
        <author/>
        <notes/>
        <lastID>114</lastID>
        <request>
            <task definition_id="system_start_v1" id="start" name="Start" x="10" y="10">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters/>
                <messages/>
                <dependents>
                    <task label="" type="Complete" value="">kinetic_request_ce_submission_activity_create_v1_99</task>
                </dependents>
            </task>
            <task definition_id="system_junction_v1" id="system_junction_v1_14" name="Junction" x="1031" y="244">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters/>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_create_trigger_v1_94</task>
                </dependents>
            </task>
            <task definition_id="system_noop_v1" id="system_noop_v1_17" name="End" x="1473" y="373">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters/>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents/>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_35" name="Process Placeholders" x="185" y="308">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">&lt;%=
#placeholder_entries = JSON.parse(@results['Retrieve Integration Config']['Values JSON'])
integration_config = JSON.parse( @source['Data'] )['Integration Configuration']
placeholders = JSON.parse( integration_config['Placeholder Data'] || "[]" )

## Review each placeholder and handle any replacements in the values field.
#  Set up source data
source_data = JSON.parse( @source['Data'] )['Source Data']

#  Do replacements
placeholders.each_index{|i|
  ph = placeholders[i]['value']
  if !ph.nil?
    ph.gsub!(/\{\{(?:(?!\{\{).)*?\}\}/) do |match|
      # remove opening and closing brackets from match
      key = match[2..-3]

      # determine which part of the field to retrieve - the 'display_value' or the 'value'
      field_qualifier = 'value'
      field = key
      field_array = key.split(".")
      if field_array.length &gt; 0
        if ["display_value","value"].include? field_array[1]
          field_qualifier = field_array[1]
        end
        field = field_array[0]
      end

      #if source_data.keys.include?(key)
      if source_data.keys.include?(field)
        source_data[field][field_qualifier] || source_data[field]
      else
        match
      end
    end
    placeholders[i]['value'] = ph
  end
}

placeholders.to_json
%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_88</task>
                </dependents>
            </task>
            <task definition_id="kinetic_request_ce_datastore_submission_retrieve_v1" id="kinetic_request_ce_datastore_submission_retrieve_v1_41" name="Retrieve Notification XML" x="11" y="313">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Raise Error</parameter>
                    <parameter id="space_slug" label="Space Slug" menu="" required="false" tooltip="The Space the submission is being retrieved from (defaults to info value if not provided)."/>
                    <parameter id="retrieve_by" label="Retrieve By" menu="Id,Query" required="true" tooltip="How to retrieve the submission. Id or Query.">Query</parameter><!-- Retrieve By Query parameters -->
                    <parameter dependsOnId="retrieve_by" dependsOnValue="Query" id="form_slug" label="Datastore Form Slug" menu="" required="false" tooltip="Slug of the form to query">onsolve-notifications</parameter>
                    <parameter dependsOnId="retrieve_by" dependsOnValue="Query" id="index" label="Index" menu="" required="false" tooltip="The index to use for the search/retrieval">values[Notification Name]</parameter>
                    <parameter dependsOnId="retrieve_by" dependsOnValue="Query" id="query" label="Query" menu="" required="false" tooltip="A query that will retrieve a single submission">values[Notification Name] = "&lt;%= JSON.parse( @source['Data'] )['Integration Configuration']['Notification Message Template']%&gt;"</parameter><!-- Retrieve By Id parameters -->
                    <parameter dependsOnId="retrieve_by" dependsOnValue="Id" id="submission_id" label="Datastore Submission Id" menu="" required="false" tooltip="The id of the submission being retrieved."/>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_35</task>
                </dependents>
            </task>
            <task definition_id="kinetic_request_ce_submission_update_v1" id="kinetic_request_ce_submission_update_v1_53" name="Update Submission with UUID" x="540" y="352">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Raise Error</parameter>
                    <parameter id="space_slug" label="Space Slug" menu="" required="false" tooltip="The Space the submission is being retrieved from (defaults to info value if not provided)."/>
                    <parameter id="submission_id" label="Submission Id" menu="" required="true" tooltip="The id of the submission being updated.">&lt;%= JSON.parse( @source['Data'] )['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="state" label="State" menu="" required="false" tooltip="The value used to set the submission state."/>
                    <parameter id="values" label="Values" menu="" required="false" tooltip="A JSON map of field names to values that should be set.">&lt;%=
integration_config = JSON.parse( @source['Data'] )['Integration Configuration']
if @results['MIR3 One Step Notification']['Title'].to_s.empty?
  notification_title = integration_config['Notification Message Template']
else
  notification_title = @results['MIR3 One Step Notification']['Title']
end

{
 "Onsolve Id" =&gt; @results['MIR3 One Step Notification']['Notification Report UUID'],
 "Onsolve Status" =&gt; "Open",
 "OnSolve Notification Title" =&gt; notification_title
}.to_json
%&gt;</parameter>
                    <parameter id="current_page_name" label="Current Page Name" menu="" required="false" tooltip="Set the current page name."/>
                    <parameter id="current_page_navigation" label="Current Page Navigation" menu="" required="false" tooltip="Set the current page navigation."/>
                    <parameter id="origin_id" label="Origin ID" menu="" required="false" tooltip="Set the origin ID."/>
                    <parameter id="parent_id" label="Parent ID" menu="" required="false" tooltip="Set the parent ID."/>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">utilities_echo_v1_107</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_88" name="Do Recipient Replacements" x="361" y="297">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">&lt;%=
recipients = JSON.parse( @source['Data'] )['Integration Configuration']['Recipients JSON']
source_data = JSON.parse( @source['Data'] )['Source Data']

#  Do replacements
if !recipients.nil?
  recipients.gsub!(/\{\{(?:(?!\{\{).)*?\}\}/) do |match|
    # remove opening and closing brackets from match
    key = match[2..-3]

    # determine which part of the field to retrieve - the 'display_value' or the 'value'
    field_qualifier = 'value'
    field = key
    field_array = field.split(".")
    if field_array.length &gt; 0
      if ["display_value","value"].include? field_array[1]
        field_qualifier = field_array[1]
      end
      field = field_array[0]
    end

    if source_data.keys.include?(field)
      source_data[field][field_qualifier] || source_data[field]
    else
      match
    end
  end
end

recipients
%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="MIR3" type="Complete" value="JSON.parse( @source['Data'] )['Onsolve Product'] === &quot;MIR3&quot;">routine_onsolve_mir3_one_step_notification_v1_111</task>
                </dependents>
            </task>
            <task definition_id="utilities_create_trigger_v1" id="utilities_create_trigger_v1_94" name="Return Trigger" x="1176" y="230">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="action_type" label="Action Type" menu="Update,Complete" required="true" tooltip="">Complete</parameter>
                    <parameter id="deferral_token" label="Deferral Token" menu="" required="true" tooltip="">&lt;%= JSON.parse( @source['Data'] )['Deferral Token']%&gt;</parameter>
                    <parameter id="deferred_variables" label="Deferred Results" menu="" required="false" tooltip="">&lt;results&gt;
  &lt;result name="Onsolve Notification UUID"&gt;&lt;%=@results['MIR3 One Step Notification']['Notification Report UUID']%&gt;&lt;/result&gt;
  &lt;result name="Success"&gt;&lt;%=@results['MIR3 One Step Notification']['Success']%&gt;&lt;/result&gt;
&lt;/results&gt;</parameter>
                    <parameter id="message" label="Message" menu="" required="false" tooltip=""/>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="Not Forever" type="Complete" value="JSON.parse( @source['Data'] )['Integration Configuration']['Keep Task History'] == &quot;Not Forever&quot;">kinetic_request_ce_datastore_submission_create_v1_95</task>
                    <task label="Forever" type="Complete" value="JSON.parse( @source['Data'] )['Integration Configuration']['Keep Task History'] != &quot;Not Forever&quot;">system_junction_v1_100</task>
                </dependents>
            </task>
            <task definition_id="kinetic_request_ce_datastore_submission_create_v1" id="kinetic_request_ce_datastore_submission_create_v1_95" name="Add Task Run Cleanup Entry" x="1178" y="344">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Raise Error</parameter>
                    <parameter id="space_slug" label="Space Slug" menu="" required="false" tooltip="The Space the submission is being created in (defaults to info value if not provided)."/>
                    <parameter id="form_slug" label="Datastore Form Slug" menu="" required="true" tooltip="The slug of the datastore form the submission is for.">task-run-cleanup</parameter>
                    <parameter id="values" label="Values" menu="" required="false" tooltip="JSON map of submission field values.">&lt;%=
duration = JSON.parse( @source['Data'] )['Integration Configuration']['Task History Duration'].to_i

{
  "Task Run Id" =&gt; @run['Id'],
  "Delete After Date Time" =&gt; (Time.now + (86400 * duration)).iso8601
}.to_json%&gt;</parameter>
                    <parameter id="current_page_name" label="Current Page Name" menu="" required="false" tooltip="Set the current page name."/>
                    <parameter id="current_page_navigation" label="Current Page Navigation" menu="" required="false" tooltip="Set the current page navigation."/>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_100</task>
                </dependents>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_97" name="Notes / Issues" x="178.3000030517578" y="30.416671752929688">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">#1 - Work Log could be used for multiple forms.  If so, the "Incident Entry Id" field would need to change.  Could control this with input parameters, BUT are all the other fields the same??  How dynamic should we need to make this?

#2 - What if the update should be for a ticket.  We should check the configuration inputs and update the right form and field. But then must consider that we could be appending data or overwriting -- need to be sure we're doing it right.

#3 - Different versions may require / use different inputs.  Need to investigate differences between v7 v8, v9, v+  How to handle?  All config, or just "update" this run at implementation?  Or different runs for different versions?</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents/>
            </task>
            <task definition_id="kinetic_request_ce_submission_activity_create_v1" id="kinetic_request_ce_submission_activity_create_v1_99" name="Add Activity Record" x="11" y="151">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Raise Error</parameter>
                    <parameter id="space_slug" label="Space Slug" menu="" required="false" tooltip="The Space the submission exists in (defaults to info value if not provided)."/>
                    <parameter id="submission_id" label="Submission Id" menu="" required="true" tooltip="The id of the submission for which the activity is being created for.">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="label" label="Label" menu="" required="false" tooltip="The label for the submission activity.">MIR3 Notification Initiation</parameter>
                    <parameter id="description" label="Description" menu="" required="false" tooltip="The description of the submission activity."/>
                    <parameter id="type" label="Type" menu="" required="false" tooltip="Specifies the a submission activity 'Type', which should indicate what type of data is included.">Notification Initiated</parameter>
                    <parameter id="data" label="Data" menu="" required="false" tooltip="Additional data that can be used by resources consuming the submission activity record (for example a Request bundle may render submission details based upon JSON content in the activity data).">&lt;%=
{
  "Task Run Id" =&gt; @run['Id'],
  "Status" =&gt; "In Process"
}.to_json
%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">kinetic_request_ce_datastore_submission_retrieve_v1_41</task>
                </dependents>
            </task>
            <task definition_id="system_junction_v1" id="system_junction_v1_100" name="Junction: End" x="1332" y="363">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters/>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_noop_v1_17</task>
                </dependents>
            </task>
            <task definition_id="kinetic_request_ce_submission_activity_update_v1" id="kinetic_request_ce_submission_activity_update_v1_101" name="Update Activity Record" x="891" y="308">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Raise Error</parameter>
                    <parameter id="space_slug" label="Space Slug" menu="" required="false" tooltip="The Space the submission exists in (defaults to info value if not provided)."/>
                    <parameter id="submission_id" label="Submission Id" menu="" required="true" tooltip="The id of the submission for which the activity is being created for.">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="submission_activity_id" label="Submission Activity Id" menu="" required="true" tooltip="The id of the submission for which the activity is being created for.">&lt;%=@results['Add Activity Record']['Id']%&gt;</parameter>
                    <parameter id="label" label="Label" menu="" required="false" tooltip="The label for the submission activity.">MIR3 Notification Initiation</parameter>
                    <parameter id="description" label="Description" menu="" required="false" tooltip="The description of the submission activity."/>
                    <parameter id="type" label="Type" menu="" required="false" tooltip="Specifies the a submission activity 'Type', which should indicate what type of data is included.">Notification Initiated</parameter>
                    <parameter id="data" label="Data" menu="" required="false" tooltip="Additional data that can be used by resources consuming the submission activity record (for example a Request bundle may render submission details based upon JSON content in the activity data).">&lt;%=
{
  "Task Run Id" =&gt; @run['Id'],
  "Status" =&gt; "Completed",
  "Comments" =&gt; @results['Work Note Content']['output']
}.to_json
%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_14</task>
                    <task label="If updates configured" type="Complete" value="JSON.parse( @source['Data'] )['Integration Configuration']['Notification Initiation Action'] != &quot;None&quot;">routine_kinetic_submission_create_v1_112</task>
                </dependents>
            </task>
            <task definition_id="kinetic_request_ce_submission_update_v1" id="kinetic_request_ce_submission_update_v1_102" name="Update Submission - Error" x="726" y="172">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Raise Error</parameter>
                    <parameter id="space_slug" label="Space Slug" menu="" required="false" tooltip="The Space the submission is being retrieved from (defaults to info value if not provided)."/>
                    <parameter id="submission_id" label="Submission Id" menu="" required="true" tooltip="The id of the submission being updated.">&lt;%= JSON.parse( @source['Data'] )['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="state" label="State" menu="" required="false" tooltip="The value used to set the submission state."/>
                    <parameter id="values" label="Values" menu="" required="false" tooltip="A JSON map of field names to values that should be set.">&lt;%=
{
 "Onsolve Status" =&gt; "Initiation Error"
}.to_json
%&gt;</parameter>
                    <parameter id="current_page_name" label="Current Page Name" menu="" required="false" tooltip="Set the current page name."/>
                    <parameter id="current_page_navigation" label="Current Page Navigation" menu="" required="false" tooltip="Set the current page navigation."/>
                    <parameter id="origin_id" label="Origin ID" menu="" required="false" tooltip="Set the origin ID."/>
                    <parameter id="parent_id" label="Parent ID" menu="" required="false" tooltip="Set the parent ID."/>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">kinetic_request_ce_submission_activity_update_v1_103</task>
                </dependents>
            </task>
            <task definition_id="kinetic_request_ce_submission_activity_update_v1" id="kinetic_request_ce_submission_activity_update_v1_103" name="Update Activity Record Error" x="892" y="163">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="error_handling" label="Error Handling" menu="Error Message,Raise Error" required="true" tooltip="Determine what to return if an error is encountered.">Raise Error</parameter>
                    <parameter id="space_slug" label="Space Slug" menu="" required="false" tooltip="The Space the submission exists in (defaults to info value if not provided)."/>
                    <parameter id="submission_id" label="Submission Id" menu="" required="true" tooltip="The id of the submission for which the activity is being created for.">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="submission_activity_id" label="Submission Activity Id" menu="" required="true" tooltip="The id of the submission for which the activity is being created for.">&lt;%=@results['Add Activity Record']['Id']%&gt;</parameter>
                    <parameter id="label" label="Label" menu="" required="false" tooltip="The label for the submission activity.">MIR3 Notification Initiation - Error</parameter>
                    <parameter id="description" label="Description" menu="" required="false" tooltip="The description of the submission activity."/>
                    <parameter id="type" label="Type" menu="" required="false" tooltip="Specifies the a submission activity 'Type', which should indicate what type of data is included.">Notification Initiated Error</parameter>
                    <parameter id="data" label="Data" menu="" required="false" tooltip="Additional data that can be used by resources consuming the submission activity record (for example a Request bundle may render submission details based upon JSON content in the activity data).">&lt;%=
results = JSON.parse(@results['MIR3 One Step Notification']['Output'])
comments = "MIR3 Initiation Error:"
results['error'].each{|key,value|
  comments &lt;&lt; "\n#{key}: #{value}"
}

{
  "Task Run Id" =&gt; @run['Id'],
  "Status" =&gt; "Errored",
  "Comments" =&gt; comments
}.to_json
%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">system_junction_v1_14</task>
                    <task label="" type="Complete" value="">routine_kinetic_submission_create_v1_114</task>
                </dependents>
            </task>
            <task definition_id="routine_onsolve_error_v1" id="routine_onsolve_error_v1_104" name="OnSolve Error Notification" x="538" y="88">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="Error Message Title" label="Error Message Title" menu="" required="true" tooltip="The title of the error message to be send with the error notification">&lt;%=
integration_config = JSON.parse( @source['Data'] )['Integration Configuration']
source_data = JSON.parse( @source['Data'] )['Source Data']
client_reference = source_data[integration_config['External Unique Key Field Name']]

"Unable to initiate notification in MIR3 for #{client_reference} (integration: #{integration_config['Name']})"
%&gt;</parameter>
                    <parameter id="Error Message Details" label="Error Message Details" menu="" required="true" tooltip="The error message details to be sent with the error notification">&lt;%=
results = JSON.parse(@results['MIR3 One Step Notification']['Output'])
comments = ""
results['error'].each{|key,value|
  comments &lt;&lt; "\n#{key}: #{value}"
}
comments
%&gt;</parameter>
                    <parameter id="Integration Id" label="Integration Id" menu="" required="false" tooltip="The Submission Id of the integration configuration record"/>
                    <parameter id="Submission Id" label="Submission Id" menu="" required="false" tooltip="The Submission Id of the Task Activity Monitor record">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="Recipient List" label="Recipient List" menu="" required="false" tooltip="The receipient list to receive the notification">&lt;%=JSON.parse( @source['Data'] )['Integration Configuration']['Error Notification Email']%&gt;</parameter>
                    <parameter id="Task Run" label="Task Run" menu="" required="false" tooltip="">&lt;%=@run['Id']%&gt;</parameter>
                    <parameter id="Additional Info" label="Additional Info" menu="" required="false" tooltip=""/>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents/>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_106" name="Dev Notes - 01" x="985" y="109">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">Decision was made to *always* update the Remedy ticket if there was an error in initiating the notification.  For successful, we follow the configuration meaning we only post an update to the Remedy ticket if the configuration so indicates.</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents/>
            </task>
            <task definition_id="utilities_echo_v1" id="utilities_echo_v1_107" name="Work Note Content" x="737" y="360">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>false</deferrable>
                <visible>true</visible>
                <parameters>
                    <parameter id="input" label="Input" menu="" required="true" tooltip="">&lt;%=
integration_config = JSON.parse( @source['Data'] )['Integration Configuration']
notification_method_options = {"calloutInfo" =&gt; "Callout", "broadcastInfo" =&gt; "Broadcast", "bulletinBoardInfo" =&gt; "Bulletin Board", "firstResponseInfo" =&gt; "First Response"}
notification_method = notification_method_options[integration_config['Notification Method']]

# Build note
work_notes = ["#{notification_method} Notification"]
if @results['MIR3 One Step Notification']['Title'].to_s.empty?
  work_notes.push( "\"#{integration_config['Notification Message Template']}\"" )
else
  work_notes.push( "\"#{@results['MIR3 One Step Notification']['Title']}\"" )
end
work_notes.push( "(UUID #{@results['MIR3 One Step Notification']['Notification Report UUID']})" )
work_notes.push( "was successfully initiated" )

recipients = JSON.parse(@results['Do Recipient Replacements']['output'])
if notification_method == "Callout" || notification_method == "First Response"
  if recipients.has_key?("Escalation Level 1") &amp;&amp; !recipients['Escalation Level 1']['groups'].to_s.empty?
    work_notes.push( "to #{recipients['Escalation Level 1']['groups']}" )
  end
end
if notification_method == "Broadcast" || notification_method == "Bulletin Board"
  if recipients.has_key?("groups") &amp;&amp; !recipients['groups'].to_s.empty?
    work_notes.push( "to #{recipients['groups']}" )
  end
end

work_notes.join(" ")+"."
%&gt;</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="" type="Complete" value="">kinetic_request_ce_submission_activity_update_v1_101</task>
                </dependents>
            </task>
            <task definition_id="routine_onsolve_mir3_one_step_notification_v1" id="routine_onsolve_mir3_one_step_notification_v1_111" name="MIR3 One Step Notification" x="535" y="214">
                <version>1</version>
                <configured>true</configured>
                <defers>true</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="Notification Detail" label="Notification Detail" menu="" required="true" tooltip="The title of the notification to be found and retrieved">&lt;%=JSON.parse(@results['Retrieve Notification XML']['Values JSON'])['Notification XML']%&gt;</parameter>
                    <parameter id="Placeholder JSON" label="Placeholder JSON" menu="" required="false" tooltip="An object that contains the placeholder names and values: [{&quot;name&quot;:&quot;placeholder name&quot;, &quot;value&quot;:&quot;placeholder value&quot;},{&quot;name&quot;:&quot;placeholder name 2&quot;, &quot;value&quot;:&quot;placeholder value 2&quot;}...]">&lt;%=@results['Process Placeholders']['output']%&gt;</parameter>
                    <parameter id="MIR3 Individual Recipient Field" label="MIR3 Individual Recipient Field" menu="" required="true" tooltip="The MIR3 field that contains the value(s) provided in the Individual Recipients List.  Required field, even if individual receipients is not populated.  Common values are 'employeeId' and 'username'">&lt;%= 
default = "username"
unique_field = JSON.parse( @source['Data'] )['MIR3 Unique User Match Field']

if unique_field.to_s.empty?
  default
else
  unique_field
end
%&gt;

</parameter>
                    <parameter id="Recipients JSON" label="Recipients JSON" menu="" required="true" tooltip="JSON object of recipients in one of two formats {&quot;individuals&quot;:&quot;...&quot;,&quot;groups&quot;:&quot;...&quot;,&quot;schedules&quot;:&quot;...&quot;} or {&quot;Escalation Level 1&quot;:{&quot;individuals&quot;:&quot;...&quot;,&quot;groups&quot;:&quot;...&quot;,&quot;schedules&quot;:&quot;...&quot;},&quot;Escalation Level 2&quot;:{...}}}">&lt;%=@results['Do Recipient Replacements']['output']%&gt;</parameter>
                    <parameter id="OnCall JSON" label="OnCall JSON" menu="" required="false" tooltip="JSON object corresponding to Oncall, arranged as follows:  {&quot;1&quot;:[&quot;user1&quot;,&quot;user2&quot;],&quot;2&quot;:[&quot;user3&quot;],...}"/>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="Unsuccessful" type="Complete" value="@results['MIR3 One Step Notification']['Success'] != &quot;true&quot;">kinetic_request_ce_submission_update_v1_102</task>
                    <task label="Unsuccessful" type="Complete" value="@results['MIR3 One Step Notification']['Success'] != &quot;true&quot;">routine_onsolve_error_v1_104</task>
                    <task label="Successful" type="Complete" value="@results['MIR3 One Step Notification']['Success'] == &quot;true&quot;">kinetic_request_ce_submission_update_v1_53</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submission_create_v1" id="routine_kinetic_submission_create_v1_112" name="Outbound Activity - Alerting Initiated" x="891" y="452">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="Kapp Slug" label="Kapp Slug" menu="" required="true" tooltip="The slug of the Kapp to create the submission in">task-activity-monitor</parameter>
                    <parameter id="Form Slug" label="Form Slug" menu="" required="true" tooltip="The slug of the Form to create the submission in">outbound-activity</parameter>
                    <parameter id="Current Page Name" label="Current Page Name" menu="" required="false" tooltip="The page to set the submission to"/>
                    <parameter id="Current Page Navigation" label="Current Page Navigation" menu="" required="false" tooltip="The direction of the next page (next or previous)"/>
                    <parameter id="Values JSON" label="Values JSON" menu="" required="false" tooltip="A JSON Map of values to set into the submissions fields">&lt;%=
integration_config = JSON.parse( @source['Data'] )['Integration Configuration']
parameters = JSON.parse(integration_config['Initiation Standard Action Parameters'])
source_data = JSON.parse( @source['Data'] )['Source Data']

{
  "Status" =&gt; "New",
  "Source" =&gt; "Remedy",
  "Source Id" =&gt; JSON.parse( @source['Data'] )['Source Id'],
  "Source Reference Id" =&gt; source_data[integration_config['External Unique Key Field Name']],
  "UUID" =&gt; @results['MIR3 One Step Notification']['Notification Report UUID'],
  "Task Activity Monitor Record" =&gt; JSON.parse(@source['Data'])['Task Activity Monitor Submission'],
  "Related Activity Record" =&gt; @results['Add Activity Record']['Id'],
  "Action" =&gt; "Create",
  "Payload" =&gt; {
    "form" =&gt; parameters["Work Log Form"],
    "field_values" =&gt; {
      "Incident Entry ID" =&gt; JSON.parse( @source['Data'] )['Source Id'],
      "Secure Work Log" =&gt; "Yes",
      "View Access" =&gt; "Internal",
      "Communication Source" =&gt; "Web",
      "z1D Previous Operation" =&gt; "SET",
      "Status" =&gt; "Enabled",
      "Work Log Type" =&gt; "General Information",
      "Incident Number" =&gt; source_data[integration_config['External Unique Key Field Name']],
      "Description" =&gt; "Alerting Initiated",
      "Detailed Description" =&gt; @results['Work Note Content']['output'],
      "Work Log Date" =&gt; Time.now().iso8601
    }.to_json
  }.to_json
}.to_json
%&gt;</parameter>
                    <parameter id="Origin Id" label="Origin Id" menu="" required="false" tooltip="Sets the submissions origin to another Kinetic Submission">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="Parent Id" label="Parent Id" menu="" required="false" tooltip="Sets the submissions parent to another Kinetic Submission">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="Submit Submission" label="Submit Submission" menu="" required="false" tooltip="True or False, if Submission should be Submitted when created">True</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents>
                    <task label="Update Source Record?" type="Complete" value="integration_config = JSON.parse( @source['Data'] )['Integration Configuration']&#10;&#10;integration_config['Polling'] == &quot;Yes&quot; &amp;&amp; !integration_config['Fields to Update Upon Notification'].to_s.empty?">routine_kinetic_submission_create_v1_113</task>
                </dependents>
            </task>
            <task definition_id="routine_kinetic_submission_create_v1" id="routine_kinetic_submission_create_v1_113" name="Outbound Activity - Update Remedy Ticket" x="892" y="594">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="Kapp Slug" label="Kapp Slug" menu="" required="true" tooltip="The slug of the Kapp to create the submission in">task-activity-monitor</parameter>
                    <parameter id="Form Slug" label="Form Slug" menu="" required="true" tooltip="The slug of the Form to create the submission in">outbound-activity</parameter>
                    <parameter id="Current Page Name" label="Current Page Name" menu="" required="false" tooltip="The page to set the submission to"/>
                    <parameter id="Current Page Navigation" label="Current Page Navigation" menu="" required="false" tooltip="The direction of the next page (next or previous)"/>
                    <parameter id="Values JSON" label="Values JSON" menu="" required="false" tooltip="A JSON Map of values to set into the submissions fields">&lt;%=
integration_config = JSON.parse( @source['Data'] )['Integration Configuration']
source_data = JSON.parse( @source['Data'] )['Source Data']

{
  "Status" =&gt; "New",
  "Source" =&gt; "Remedy",
  "Source Id" =&gt; JSON.parse( @source['Data'] )['Source Id'],
  "Source Reference Id" =&gt; source_data[integration_config['External Unique Key Field Name']],
  "UUID" =&gt; @results['MIR3 One Step Notification']['Notification Report UUID'],
  "Task Activity Monitor Record" =&gt; JSON.parse(@source['Data'])['Task Activity Monitor Submission'],
  "Related Activity Record" =&gt; @results['Add Activity Record']['Id'],
  "Action" =&gt; "Create",
  "Payload" =&gt; {
    "form" =&gt; integration_config['Schema Name'],
    "request_id" =&gt; JSON.parse( @source['Data'] )['Source Id'],
    "field_values" =&gt; integration_config['Fields to Update Upon Notification']
  }.to_json
}.to_json
%&gt;</parameter>
                    <parameter id="Origin Id" label="Origin Id" menu="" required="false" tooltip="Sets the submissions origin to another Kinetic Submission">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="Parent Id" label="Parent Id" menu="" required="false" tooltip="Sets the submissions parent to another Kinetic Submission">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="Submit Submission" label="Submit Submission" menu="" required="false" tooltip="True or False, if Submission should be Submitted when created">True</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents/>
            </task>
            <task definition_id="routine_kinetic_submission_create_v1" id="routine_kinetic_submission_create_v1_114" name="Outbound Activity - Alerting Initiated - Error" x="891" y="10">
                <version>1</version>
                <configured>true</configured>
                <defers>false</defers>
                <deferrable>true</deferrable>
                <visible>false</visible>
                <parameters>
                    <parameter id="Kapp Slug" label="Kapp Slug" menu="" required="true" tooltip="The slug of the Kapp to create the submission in">task-activity-monitor</parameter>
                    <parameter id="Form Slug" label="Form Slug" menu="" required="true" tooltip="The slug of the Form to create the submission in">outbound-activity</parameter>
                    <parameter id="Current Page Name" label="Current Page Name" menu="" required="false" tooltip="The page to set the submission to"/>
                    <parameter id="Current Page Navigation" label="Current Page Navigation" menu="" required="false" tooltip="The direction of the next page (next or previous)"/>
                    <parameter id="Values JSON" label="Values JSON" menu="" required="false" tooltip="A JSON Map of values to set into the submissions fields">&lt;%=
integration_config = JSON.parse( @source['Data'] )['Integration Configuration']
parameters = JSON.parse(integration_config['Initiation Standard Action Parameters'])
source_data = JSON.parse( @source['Data'] )['Source Data']
notification_method_options = {"calloutInfo" =&gt; "Callout", "broadcastInfo" =&gt; "Broadcast", "bulletinBoardInfo" =&gt; "Bulletin Board", "firstResponseInfo" =&gt; "First Response"}
notification_method = notification_method_options[integration_config['Notification Method']]

work_notes = ["Kinetic was unable to initiate the #{notification_method} \"#{integration_config['Notification Message Template']}\". Error message (if applicable):"]
results = JSON.parse(@results['MIR3 One Step Notification']['Output'])
results['error'].each{|key,value|
  work_notes.push( "#{key}: #{value}" )
}

{
  "Status" =&gt; "New",
  "Source" =&gt; "Remedy",
  "Source Id" =&gt; JSON.parse( @source['Data'] )['Source Id'],
  "Source Reference Id" =&gt; source_data[integration_config['External Unique Key Field Name']],
  "UUID" =&gt; @results['MIR3 One Step Notification']['Notification Report UUID'],
  "Task Activity Monitor Record" =&gt; JSON.parse(@source['Data'])['Task Activity Monitor Submission'],
  "Related Activity Record" =&gt; @results['Add Activity Record']['Id'],
  "Action" =&gt; "Create",
  "Payload" =&gt; {
    "form" =&gt; parameters["Work Log Form"],
    "field_values" =&gt; {
      "Incident Entry ID" =&gt; JSON.parse( @source['Data'] )['Source Id'],
      "Secure Work Log" =&gt; "Yes",
      "View Access" =&gt; "Internal",
      "Communication Source" =&gt; "Web",
      "z1D Previous Operation" =&gt; "SET",
      "Status" =&gt; "Enabled",
      "Work Log Type" =&gt; "General Information",
      "Incident Number" =&gt; source_data[integration_config['External Unique Key Field Name']],
      "Description" =&gt; "Alerting Initiated - Error",
      "Detailed Description" =&gt; work_notes.join("\n"),
      "Work Log Date" =&gt; Time.now().iso8601
    }.to_json
  }.to_json
}.to_json
%&gt;</parameter>
                    <parameter id="Origin Id" label="Origin Id" menu="" required="false" tooltip="Sets the submissions origin to another Kinetic Submission">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="Parent Id" label="Parent Id" menu="" required="false" tooltip="Sets the submissions parent to another Kinetic Submission">&lt;%=JSON.parse(@source['Data'])['Task Activity Monitor Submission']%&gt;</parameter>
                    <parameter id="Submit Submission" label="Submit Submission" menu="" required="false" tooltip="True or False, if Submission should be Submitted when created">True</parameter>
                </parameters>
                <messages>
                    <message type="Create"/>
                    <message type="Update"/>
                    <message type="Complete"/>
                </messages>
                <dependents/>
            </task>
        </request>
    </taskTree>
</tree>